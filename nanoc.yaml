text_extensions: [ 'atom', 'conf', 'css', 'erb', 'haml', 'htm', 'html', 'js', 'markdown', 'md', 'rb', 'sass', 'scss', 'svg', 'tex', 'ttl', 'txt', 'xml' ]

# Config for Nanoc commands

checks: &checks
  internal_links:
    exclude: [ '^/blog/feed' ]

  external_links:
    exclude: [ 'example.org' ]

deploy:
  public:
    kind: rsync
    dst: "lifepreserver@pentandra.com:/srv/http/lifepreserver"
    options: [ '-gplPrtvz', '--delete-after', '--exclude=/logs', '--rsync-path=sudo rsync' ]
  staging:
    kind: rsync
    dst: "vlad@rebikov.process.tree:/srv/http/lifepreserver"
    options: [ '-gplPrtvz', '--delete-after' ]

prune:
  auto_prune: true
  exclude: [ 'logs', 'uwsgi_temp', 'scgi_temp', 'proxy_temp', 'fastcgi_temp', 'client_body_temp' ]

view:
  static_root: &static_root /static

# Config for Nanoc data sources

data_sources:
  - type: filesystem
    content_dir: app
    layouts_dir: ~

  - type: filesystem
    content_dir: static
    items_root: *static_root

  - type: dependencies
    items_root: &dependencies_root /_dependencies

  - type : dictionaries
    items_root: &dictionaries_root /_dictionaries
    search_paths:
      - 'var/dictionaries'
    ordered_locales: [ 'en_US', 'en_GB', 'es_ES', 'fr_FR', 'nl_NL', 'de_DE', 'it_IT' ]

  - type: tags
    items_root: &tags_root /tags
    author_tags: 'etc/tags.yaml'
    tag_metadata: 'var/additional_tag_data.yaml'

  - type: vocabularies
    items_root: &vocabularies_root /_vocabularies
    extra_metadata: 'var/voaf_metadata.yaml'
    prefix_overrides:
      :https://pentandra.com#: p5web
      :https://pentandra.com/company#: p5inc
      :https://pentandra.com/blog#: p5blog
    categories:
      standard:   [ cc, ctag, dc, foaf, owl, pav, prov, rdf, rdfs, schema, sh, sioc, skos, xhv ]
      business:   [ essglobal, fea, org, rov, vcard ]
      open_graph: [ article, og, profile ]
      document:   [ bibo, deo, doco, fabio ]
      instances:  [ dbo, dbr, yago ]
      social:     [ ldp, oa ]
      meta:       [ deps, doap, vann, voaf, void, vs ]
      pentandra:  [ p5inc, p5blog, p5web ]
      extra:      [ cert, essglobalactivities, essgloballegalform, essglobalqualifiers, essglobaltypeoflabour, sioctypes, xsd ]

  - type: company
    items_root: &company_root /company
    organizations_root: &organizations_root /organizations
    people_root: &people_root /people
    company_metafile: 'var/company.ldif'

  - type: people
    items_root: *people_root
    people_data: 'etc/people.yaml'

base_url: &base_url "https://pentandra.com"

blog: &blog
  title: The Pentandra Blog
  author_name: Pentandra
  author_uri: *base_url
  path: /blog
  tags_path: /tags
  archives_path: /archives
  feed_path: /blog/feed

cache:
  short_urls: 'var/short_urls.yaml'

company_root: *company_root
dependencies_root: *dependencies_root
dictionaries_root: *dictionaries_root
images_root: /assets/images
orgs_root: *organizations_root
people_root: *people_root
posts_root: /posts
static_root: *static_root
tags_root: *tags_root
vocabularies_root: *vocabularies_root

erb:
  trim_mode: '>'

git:
  url: "https://github.com/pentandra/lifepreserver.git"
  browse_url: "https://github.com/pentandra/lifepreserver"
  tag_url: "https://github.com/pentandra/lifepreserver/releases/tag"
  version_history_url: "https://github.com/lifepreserver/commits/master"

site: &site
  name: Pentandra
  motto: Breaking Research Barriers
  recent_thoughts_limit: 5
  generate_meta: true

# Environment-specific configuration
environments:

  development: &development

    enable_output_diff: true

    site: # Simplify dependencies for quicker compilation during development
      <<: *site
      recent_thoughts_limit: 0
      generate_meta: false

    context2pdf:
      debug: true
      trackers: [ 'graphics.locating' ]

    checks:
      <<: *checks
      internal_links:
        exclude: [ '^/blog/feed', '^/archives' ]

    server:
      name: 'localhost'
      pid_file: 'logs/nginx.pid'
      error_log: 'stderr info'
      port: 3125
      port_tls: 4125
      tls_certificate: 'etc/certs/server.crt'
      tls_certificate_key: 'etc/certs/server.key'
      tls_dhparam: 'etc/certs/dhparam.pem'

  static_only:
    <<: *development
    ignore_server_items: true

  production: &production

    require_git_tag: true # All production releases must be at a tag

    output_dir: 'output_prod'

    google_analytics:
      code: UA-26002603-1
      site: pentandra.com

    production: true

    server:
      name: 'pentandra.com'
      pid_file: '/var/run/nginx.pid'
      error_log: 'logs/error.log'
      port: 80
      port_tls: 443
      platform: 'linux'
      tls_certificate: '/etc/letsencrypt/live/pentandra.com/fullchain.pem'
      tls_certificate_key: '/etc/letsencrypt/live/pentandra.com/privkey.pem'
      tls_trusted_certificate: '/etc/letsencrypt/live/pentandra.com/chain.pem'
      tls_dhparam: '/etc/letsencrypt/live/pentandra.com/dhparam.pem'

  staging:
    <<: *production

    require_git_tag: false
